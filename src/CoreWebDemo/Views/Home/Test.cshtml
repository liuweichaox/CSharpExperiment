
@{
    ViewData["Title"] = "Test";
}

<div>
    <h2>jQuery Ajax 上传</h2>
    <input type="file" id="file" name="file" multiple />
    <button id="btn">测试</button>
    <h2>jQuery Ajax 预览上传</h2>
    <input type="file" id="fileElem" multiple accept="image/*" style="display:none" onchange="handleFiles(this.files)">
    <a href="#" id="fileSelect">上传文件</a>
    <div id="fileList">
        <p>No files selected!</p>
    </div>
</div>
<div style="clear:both"></div>
<div>
    <h2>FORM表单上传</h2>
    <form method="post" enctype="multipart/form-data" asp-controller="home" asp-action="UploadFile">
        <div class="form-group">
            <div class="col-md-10">
                <p>使用此表单上传一个或多个文件</p>
                <input type="file" name="files" multiple />
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-10">
                <input type="submit" value="Upload" />
            </div>
        </div>
    </form>
</div>
<div style="clear:both"></div>
<script>

    document.getElementById("btn").onclick = function () {

        var file = document.getElementById("file");

        var files = file.files;//每一个file对象对应一个文件。

        //file.name//获取本地文件系统的文件名。

        //file.size//文件的字节大小。

        //file.type//字符串类型,文件的MIME类型。

        //file.lastModifiedDate//文件的最后修改时间。(只使用于Chrome浏览器)


        var formData = new FormData();
        for (var i = 0; i < files.length; i++) {
            formData.append(files[i].name, files[i]);
        }
        formData.append("Name", "LiuWeichao");
        var reader = new FileReader();

        //reader.readAsText(file.files[0]);

        //reader.onload = function () {
        //    console.log(reader.result);
        //}
        console.log(file.files);
        console.log(formData);

        //window.URL.createObjectURL()


        UploadFile(formData);
    }


    window.URL = window.URL || window.webkitURL;

    var fileSelect = document.getElementById("fileSelect"),
        fileElem = document.getElementById("fileElem"),
        fileList = document.getElementById("fileList");

    fileSelect.addEventListener("click", function (e) {
        if (fileElem) {
            fileElem.click();
        }
        e.preventDefault(); // prevent navigation to "#"
    }, false);

    function handleFiles(files) {
        if (!files.length) {
            fileList.innerHTML = "<p>No files selected!</p>";
        } else {
            fileList.innerHTML = "";
            var list = document.createElement("ul");
            fileList.appendChild(list);
            var formData = new FormData();
            for (var i = 0; i < files.length; i++) {
                formData.append(files[i].name, files[i]);
                var li = document.createElement("li");
                list.appendChild(li);

                var img = document.createElement("img");
                img.src = window.URL.createObjectURL(files[i]);
                img.height = 60;
                img.onload = function () {
                    window.URL.revokeObjectURL(this.src);
                }
                li.appendChild(img);
                var info = document.createElement("span");
                info.innerHTML = files[i].name + ": " + files[i].size + " bytes";
                li.appendChild(info);
            }
            UploadFile(formData);
        }
    }

    /**
     * 上传文件方法
     * @@param fileData
     */
    var UploadFile = function (fileData) {
        $.ajax({
            url: "UploadFile",
            type: "POST",
            async: true,
            cache: false,
            data: fileData,
            contentType: false, //必须false才会避开jQuery对 formdata 的默认处理
            processData: false, //必须false才会自动加上正确的Content-Type
            success: function (data) {
                alert(data);
                console.log(data);
            }
        });
    };

</script>
